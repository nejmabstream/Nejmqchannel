import re
import requests
import telepot
import schedule
import time

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨ÙˆØª
BOT_TOKEN = "7710008981:AAHPz0QR48jwkRe4tPynOR-SpKPeySnyJUw"
CHAT_IDS = ["6444681745", "11", "11", "11"]

# Ø±Ø§Ø¨Ø· Ù…Ù„Ù GitHub Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
GITHUB_URL = "https://raw.githubusercontent.com/nejmabstream/Nejmqchannel/main/com.styog.yallanajmapr.html"

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙˆØª
bot = telepot.Bot(BOT_TOKEN)

# ØªØ®Ø²ÙŠÙ† Ø¢Ø®Ø± Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±
last_sent_links = set()

# Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
CHANNEL_ORDER = [
    "beIN Sport News", "beIN Sport 1", "beIN Sport 2", "beIN Sport 3",
    "beIN Sport 4", "beIN Sport 5", "beIN Sport 6", "beIN Sport 7",
    "beIN Sport 8", "beIN Sport 9", "beIN Sport 10",
    "SSC EXTRA 11", "AD SPORTS 12", "RIADDIA 13", "EXTRA 13"
]

# Ø¯Ø§Ù„Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ù† Ø§Ù„Ù†Øµ
def extract_video_links(text):
    pattern = r"https://video[^\s;]+"  # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ù€ https://video
    return list(set(re.findall(pattern, text)))  # Ø§Ø³ØªØ®Ø¯Ø§Ù… set Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø±

# Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù…Ø¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
def send_channels_with_links(links):
    message = "ğŸ“¡ **Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©:**\n\n"

    for idx, channel in enumerate(CHANNEL_ORDER, start=1):
        link = links[idx - 1] if idx - 1 < len(links) else None  # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø±Ø§Ø¨Ø·

        if link:
            message += f"âœ… **#{channel}**\nğŸ”— [Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±]({link})\n\n"
        else:
            message += f"âŒ **#{channel}** (Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ø­Ø§Ù„ÙŠÙ‹Ø§)\n\n"

    for chat_id in CHAT_IDS:
        try:
            bot.sendMessage(chat_id, message, parse_mode="Markdown", disable_web_page_preview=True)
            print(f"âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ù„Ù‰ {chat_id}")
        except Exception as e:
            print(f"â— Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¥Ù„Ù‰ {chat_id}: {e}")

# Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
def fetch_and_send_links():
    global last_sent_links
    try:
        print("ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† GitHub...")
        response = requests.get(GITHUB_URL, timeout=5)

        if response.status_code == 200:
            content = response.text
            video_links = extract_video_links(content)  # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·

            # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
            new_links = set(video_links) - last_sent_links  # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·

            if new_links:  # ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø±ÙˆØ§Ø¨Ø· Ø¬Ø¯ÙŠØ¯Ø©
                last_sent_links.update(new_links)  # ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø±Ø³Ù„Ø©
                send_channels_with_links(list(new_links))  # Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
                print(f"âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ {len(new_links)} Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯.")
            else:
                print("âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø¬Ø¯ÙŠØ¯Ø©!")

        else:
            print(f"âŒ ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø­ØªÙˆÙ‰. Ø§Ù„Ø­Ø§Ù„Ø©: {response.status_code}")

    except requests.exceptions.RequestException as e:
        print(f"â— Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {e}")

# **Ø¥Ø±Ø³Ø§Ù„ Ø£ÙˆÙ„ Ø¯ÙØ¹Ø© ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ØªØ´ØºÙŠÙ„**
fetch_and_send_links()

# **Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„ 1 Ø¯Ù‚ÙŠÙ‚Ø©**
schedule.every(1).minutes.do(fetch_and_send_links)

# **ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© Ø¨Ø¯ÙˆÙ† 
